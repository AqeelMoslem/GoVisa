{% extends "base.html" %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/admin/admin.css' %}">
{% endblock %}

{% block content %}
<section class="visa-dashboard">
  <table class="visa-table">
    <thead>
      <tr>
        <th>Full Name</th>
        <th>Passport</th>
        <th>Destination</th>
        <th>Travel Date</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for visa in visas %}
      <tr>
        <td>{{ visa.full_name }}</td>
        <td>{{ visa.passport_number }}</td>
        <td>{{ visa.destination_country }}</td>
        <td>{{ visa.travel_date|date:"F j, Y" }}</td>
        <td>
          <span class="status {{ visa.status|lower }}">{{ visa.status }}</span>
          {% if visa.document %}
            <br>
            <a href="{{ visa.document.url }}" target="_blank" class="file-link">ðŸ“Ž View File</a>
          {% endif %}
        </td>
        <td>
          <form method="post" action="{% url 'admin-update-visa' visa.id %}" enctype="multipart/form-data" class="status-form">
    {% csrf_token %}
    <select name="status" class="status-select" onchange="toggleFileUpload(this)">
        {% for key, val in visa.STATUS_CHOICES %}
            <option value="{{ key }}" {% if visa.status == key %}selected{% endif %}>{{ val }}</option>
        {% endfor %}
    </select>

    <div class="file-upload" {% if visa.status != 'Completed' %}style="display:none"{% endif %}>
        <label>Upload :</label>
        <input type="file" name="upload_file">
    </div>

    <button type="submit" class="btn">Update</button>
</form>

        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6">No visa applications found.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</section>
{% endblock %}
